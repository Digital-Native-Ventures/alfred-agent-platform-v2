services:
  supabase-studio:
    healthcheck:
      test: ["CMD-SHELL", "echo 'Supabase Studio is running'"]
      interval: 5s
      timeout: 5s
      retries: 3
      start_period: 10s
    environment:
      SUPABASE_URL: http://supabase-rest:3000
      SUPABASE_PUBLIC_URL: http://localhost:3000
      NEXT_PUBLIC_SUPABASE_URL: http://localhost:3000
      NEXT_PUBLIC_SUPABASE_ANON_KEY: ${ANON_KEY}
      STUDIO_PG_META_URL: http://supabase-db:5432
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      DEFAULT_ORGANIZATION_NAME: Default
      DEFAULT_PROJECT_NAME: Default
      
  grafana:
    volumes:
      - ./monitoring/grafana/dashboards:/var/lib/grafana/dashboards
      - ./monitoring/grafana/provisioning:/etc/grafana/provisioning
      - grafana-data:/var/lib/grafana
    environment:
      GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_ADMIN_PASSWORD:-admin}
      GF_DASHBOARDS_MIN_REFRESH_INTERVAL: 5s
      GF_AUTH_ANONYMOUS_ENABLED: "true"
      GF_AUTH_ANONYMOUS_ORG_ROLE: Viewer
      GF_PATHS_PROVISIONING: /etc/grafana/provisioning
      
  prometheus:
    volumes:
      - ./monitoring/prometheus:/etc/prometheus
      - prometheus-data:/prometheus
    command:
      - --config.file=/etc/prometheus/prometheus.yml
      - --storage.tsdb.path=/prometheus
      - --web.console.libraries=/etc/prometheus/console_libraries
      - --web.console.templates=/etc/prometheus/consoles
      - --web.enable-lifecycle
