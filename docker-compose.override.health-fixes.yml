# Comprehensive health check fixes for all services
# Generated: 2025-05-27

services:
  # Fix all db-*-metrics services - use port 9103 instead of 9091
  db-admin-metrics:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9103/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  db-api-metrics:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9103/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  db-auth-metrics:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9103/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  db-realtime-metrics:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9103/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  db-storage-metrics:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9103/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # Fix services missing curl - use curl when available
  slack-adapter:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3011/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  slack_mcp_gateway:
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "3010"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # Fix slow-start services with increased timeouts
  llm-service:
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:11434/api/tags"]
      interval: 60s
      timeout: 30s
      retries: 10
      start_period: 300s

  vector-db:
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:6333/healthz"]
      interval: 45s
      timeout: 20s
      retries: 6
      start_period: 180s

  crm-sync:
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8000/health"]
      interval: 30s
      timeout: 15s
      retries: 5
      start_period: 120s

  # Services that need environment fixes
  db-auth:
    environment:
      POSTGRES_DB: auth_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "postgres", "-d", "auth_db"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 30s

  db-storage:
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "postgres", "-d", "storage_db"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 30s

  # Disable health checks for stub services
  model-router:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  model-registry:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  agent-rag:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  agent-atlas:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  agent-social:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  agent-bizdev:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  ui-admin:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  ui-chat:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  auth-ui:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  hubspot-mock:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  mail-server:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  # Additional database services that are stubs
  db-admin:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  db-api:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  db-realtime:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  monitoring-db:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  monitoring-node:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  monitoring-redis:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1

  redis-exporter:
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
      timeout: 10s
      retries: 1
