# Minimal compose for CI core health check - 13 services only

# CI environment defaults
x-ci-env: &ci-env
  POSTGRES_PASSWORD: postgres
  REDIS_PASSWORD: redis123
  OPENAI_API_KEY: sk-dummy-for-ci
  SLACK_BOT_TOKEN: xoxb-dummy
  SLACK_SIGNING_SECRET: dummy
  SLACK_APP_TOKEN: xapp-dummy
  TELEGRAM_BOT_TOKEN: dummy:token

services:
  db-postgres:
    extends:
      file: docker-compose.yml
      service: db-postgres
    environment:
      <<: *ci-env
  redis:
    extends:
      file: docker-compose.yml
      service: redis
    environment:
      <<: *ci-env
  db-api:
    extends:
      file: docker-compose.yml
      service: db-api
    environment:
      <<: *ci-env
  db-auth:
    extends:
      file: docker-compose.yml
      service: db-auth
    environment:
      <<: *ci-env
  db-realtime:
    extends:
      file: docker-compose.yml
      service: db-realtime
    environment:
      <<: *ci-env
  db-storage:
    extends:
      file: docker-compose.yml
      service: db-storage
    environment:
      <<: *ci-env
  pubsub-emulator:
    extends:
      file: docker-compose.yml
      service: pubsub-emulator
  vector-db:
    extends:
      file: docker-compose.yml
      service: vector-db
  monitoring-redis:
    extends:
      file: docker-compose.yml
      service: monitoring-redis
  llm-service:
    extends:
      file: docker-compose.yml
      service: llm-service
    healthcheck:
      start_period: 45s
      retries: 5
  model-router:
    extends:
      file: docker-compose.yml
      service: model-router
    healthcheck:
      start_period: 30s
      retries: 5
  model-registry:
    extends:
      file: docker-compose.yml
      service: model-registry
    healthcheck:
      start_period: 20s
      retries: 5
  agent-core:
    extends:
      file: docker-compose.yml
      service: agent-core
    healthcheck:
      start_period: 30s
      retries: 5
  mail-server:
    extends:
      file: docker-compose.yml
      service: mail-server

networks:
  alfred-network:
    driver: bridge

volumes:
  postgres-data:
  redis-data:
  vector-db-data:
  model-data:
  pubsub-data:
  db-postgres-data:
  monitoring-redis-data:
  llm-service-data:
  db-storage-data: